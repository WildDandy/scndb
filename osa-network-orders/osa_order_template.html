<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PAGE_TITLE}}</title>

    <!-- CRITICAL: Apply theme immediately before stylesheets load -->
    <script>
        // Inline theme application to prevent FOUC
        (function() {
            const savedMode = localStorage.getItem('viewMode') || 'clean';
            console.log('Immediate theme application:', savedMode);

            if (savedMode === 'clean') {
                document.documentElement.classList.add('clean-view-loading');
                document.documentElement.style.background = 'var(--clean-bg)';
            } else {
                document.documentElement.style.background = '#000000';
            }
        })();
    </script>

    <!-- Unified CSS System -->
    <link rel="stylesheet" href="../../shared/css/base.css" />
    <link rel="stylesheet" href="../../shared/css/layout.css" />
    <link rel="stylesheet" href="../../shared/css/components.css" />
    <link rel="stylesheet" href="../../shared/css/effects.css" />
    <link rel="stylesheet" href="../../shared/css/responsive.css" />
    <link rel="stylesheet" href="../../shared/css/themes.css" />
    <link rel="stylesheet" href="../../shared/css/orders.css" />

    <!-- JavaScript Files -->
    <script src="../../shared/js/theme-manager.js" defer></script>
    <script src="../../shared/js/navigation-component.js"></script>
    
    <!-- Manual Navigation Configuration -->
    <script>
        // Define manual navigation links for this page
        window.navigationConfig = {
            navLinks: [
                { key: 'home', label: 'HOME NW', href: '../index.html' },
                { key: 'search', label: 'SEARCH', href: '../search_results.html' },
                { key: 'glossary', label: 'GLOSSARY', href: '../glossary.html' }
            ],
            currentPage: 'order'
        };
        
        // Initialize navigation with manual configuration
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.initializeNavigation(window.navigationConfig);
            });
        } else {
            window.initializeNavigation(window.navigationConfig);
        }
    </script>
    
    <script src="../../shared/js/app.js" defer></script>
</head>
<body>
    <!-- Navigation will be dynamically injected by navigation-component.js -->
    <header class="master-header header-full-width">
        <!-- Navigation component will be injected here -->
    </header>

    <section class="document-header" style="margin-top: var(--first-section-offset);">
        <div class="container">
            <div class="doc-meta">
                <div class="meta-item">
                    <div class="meta-label">Issue Date:</div>
                    <div>{{ISSUE_DATE}}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Author:</div>
                    <div>{{AUTHOR}}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Recipients:</div>
                    <div>{{RECIPIENTS}}</div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="main-content">
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>Contents</h3>
                    <ul class="sidebar-list">
                        <li class="active">Document Text</li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>Navigation</h3>
                    <ul class="sidebar-list">
                        <li onclick="location.href='{{NEXT_ORDER_FILE}}'">Next: {{NEXT_ORDER_TITLE}}</li>
                        <li onclick="location.href='../index.html'">Back to Index</li>
                    </ul>
                </div>
            </aside>

            <main class="content-area">
                <div class="content-header">
                    <div class="content-title">{{CONTENT_TITLE}}</div>
                    <div class="content-subtitle">{{CONTENT_SUBTITLE}}</div>
                </div>

                <div class="document-content">
                    <div class="original-header">
                        <div class="order-num">{{ORDER_NUM}}</div>
                        <div class="meta-info">{{RECIPIENTS}}</div>
                        <h1>{{ORDER_TITLE}}</h1>
                        <div class="meta-info meta-author">{{ORDER_SUBTITLE}}</div>
                    </div>

                    <div class="document-text">
                        {{BODY_TEXT}}
                    </div>

                    <div class="signature">
                        {{SIGNATURE}}<br><span class="signature_role">{{SIGNATURE_ROLE}}</span>
                    </div>
                </div>

                <div class="navigation-footer">
                    <div>
                        {{PREV_NAVIGATION}}
                    </div>
                    <div>
                        <a href="../index.html" class="nav-btn">INDEX</a>
                    </div>
                    <div>
                        {{NEXT_NAVIGATION}}
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>These documents are presented for research and educational purposes.<br>
            Original source: Leaked internal Scientology documents.</p>
        </div>
    </footer>
</body>
</html>